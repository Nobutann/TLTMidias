{% extends 'base.html' %}
{% load static %}

{% block title %}Jornal do Commercio{% endblock %}

{% block content %}
<div class="container">
    <div class="filters-bar">
        <form method="get" action="{% url 'article:homepage' %}" class="filter-form">
            <label for="dateFilter" class="filter-label">
                <svg class="icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <input 
                    type="date" 
                    id="dateFilter" 
                    name="data" 
                    class="date-input"
                    value="{{ search_date|default:'' }}"
                    onchange="this.form.submit()"
                >
            </label>
            {% if search_query %}
            <input type="hidden" name="q" value="{{ search_query }}">
            {% endif %}
            {% if category_slug %}
            <input type="hidden" name="categoria" value="{{ category_slug }}">
            {% endif %}
        </form>
        
        {% if search_query or search_date or category_slug %}
        <a href="{% url 'article:homepage' %}" class="clear-filters">
            Limpar filtros
        </a>
        {% endif %}
    </div>

    <div class="articles-grid">
        {% if no_results %}
        <div class="no-results">
            <svg class="no-results-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 8v4"/>
                <path d="M12 16h.01"/>
            </svg>
            <h2>Nenhuma notícia disponível</h2>
            <p>No momento não há notícias publicadas. Por favor, volte mais tarde.</p>
        </div>
        {% else %}
            {% for article in articles %}
            <article class="article-card {% if forloop.first and articles.number == 1 %}featured{% endif %}">
                {% if article.image %}
                <img src="{{ article.image.url }}" alt="{{ article.title }}" class="article-image">
                {% endif %}
                <div class="article-content">
                    <span class="article-category">{{ article.category.title }}</span>
                    <h2 class="article-title">
                        <a href="{% url 'article:details' article.pk %}">{{ article.title }}</a>
                    </h2>
                    <p class="article-excerpt">{{ article.content|truncatewords:30|striptags }}</p>
                </div>
            </article>
            {% endfor %}
        {% endif %}
    </div>

    {% if articles.paginator.num_pages > 1 %}
    <div class="pagination">
        {% if articles.has_previous %}
        <a href="?page={{ articles.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if search_date %}&data={{ search_date }}{% endif %}{% if category_slug %}&categoria={{ category_slug }}{% endif %}" 
           class="pagination-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </a>
        {% else %}
        <button class="pagination-btn" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>
        {% endif %}

        <span class="pagination-info">Página {{ articles.number }} de {{ articles.paginator.num_pages }}</span>

        {% if articles.has_next %}
        <a href="?page={{ articles.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if search_date %}&data={{ search_date }}{% endif %}{% if category_slug %}&categoria={{ category_slug }}{% endif %}" 
           class="pagination-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </a>
        {% else %}
        <button class="pagination-btn" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}